<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تقرير العمليات - الميناء (نمذج التوسعات)</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- خلفية كاملة -->
  <div class="bg-mark" aria-hidden="true"></div>

  <!-- شريط علوي (الـ pills كما في الصورة) -->
  <header class="top-nav">
    <div class="pill secondary">العودة إلى الموقع</div>
    <div class="pill">تقرير العمليات الشفت المسائي</div>
  </header>

  <!-- غلاف لتمركز البطاقة -->
  <main class="center-wrap">
    <section class="card">
      <h1 class="title">تقرير العمليات الشفت المسائي</h1>
      <p class="small-note">املأ الحقول ثم اضغط "انشاء التقرير"</p>

      <form id="reportForm" onsubmit="return false;">
        <!-- grid form: عمود التسميات على اليمين، الحقول على اليسار -->
        <div class="form-grid">

          <!-- مجموعة زمن الاستلام -->
          <div class="row-grid">
            <div class="label-col">وقت استلام الشفت</div>
            <div class="input-col">
              <input id="shiftTimeDisplay" class="input" value="6 مساءً" readonly>
            </div>
          </div>

          <!-- العمليات الأساسية: كل سطر يظهر كصفين -->
          <div class="section-title">القيادة العامة</div>

          <div class="row-grid">
            <div class="label-col">قائد امن المنشأت</div>
            <div class="input-col"><input class="input role" value="H-000" data-role="قائد امن المنشأت"></div>
          </div>

          <div class="row-grid">
            <div class="label-col">نائب قائد امن المنشأت</div>
            <div class="input-col"><input class="input role" value="H-000" data-role="نائب قائد امن المنشأت"></div>
          </div>

          <div class="section-title">القيادة (يمكن إضافة آخر)</div>

          <div class="row-grid">
            <div class="label-col">قيادة 1</div>
            <div class="input-col"><input class="input role" value="H-000" data-role="قيادة 1"></div>
          </div>

          <div class="row-grid">
            <div class="label-col">قيادة 2</div>
            <div class="input-col"><input class="input role" value="H-000" data-role="قيادة 2"></div>
          </div>

          <div class="row-grid add-row">
            <div class="label-col"></div>
            <div class="input-col">
              <button type="button" class="btn-dashed">＋ إضافة قيادة</button>
            </div>
          </div>

          <div class="section-title">الوحدات (قابلة للإضافة)</div>

          <!-- مثال على أربع وحدات مع خانة "لاعب معتمد" كـ checkbox -->
          <div class="row-grid">
            <div class="label-col">حماية 1</div>
            <div class="input-col inputs-with-checkbox">
              <label class="checkbox-inline"><input type="checkbox"> لاعب معتمد</label>
              <input class="input role" value="H-000" data-role="حماية 1">
            </div>
          </div>

          <div class="row-grid">
            <div class="label-col">حماية 2</div>
            <div class="input-col inputs-with-checkbox">
              <label class="checkbox-inline"><input type="checkbox"> لاعب معتمد</label>
              <input class="input role" value="H-000" data-role="حماية 2">
            </div>
          </div>

          <div class="row-grid">
            <div class="label-col">حماية 3</div>
            <div class="input-col inputs-with-checkbox">
              <label class="checkbox-inline"><input type="checkbox"> لاعب معتمد</label>
              <input class="input role" value="H-000" data-role="حماية 3">
            </div>
          </div>

          <div class="row-grid">
            <div class="label-col">حماية 4</div>
            <div class="input-col inputs-with-checkbox">
              <label class="checkbox-inline"><input type="checkbox"> لاعب معتمد</label>
              <input class="input role" value="H-000" data-role="حماية 4">
            </div>
          </div>

          <!-- زر إنشاء التقرير بعرض كامل -->
          <div class="row-grid full-row">
            <div class="label-col"></div>
            <div class="input-col">
              <button id="buildReport" type="button" class="btn primary large">انشاء التقرير</button>
            </div>
          </div>

          <!-- مربع النتيجة -->
          <div class="row-grid full-row">
            <div class="label-col"></div>
            <div class="input-col">
              <textarea id="reportOutput" class="report-output" placeholder="سيظهر التقرير هنا بعد الضغط"></textarea>
              <div class="copy-wrap">
                <button id="copyReport" class="btn secondary small" style="display:none">نسخ التقرير</button>
              </div>
            </div>
          </div>

        </div>
      </form>
    </section>
  </main>

<script>
  // (الكود الأصلي كما هو، مع بنية الأزرار الجديدة)
  function extractSuffixNumber(labelText){
    if (!labelText) return '';
    const m = labelText.trim().match(/(\d+)\s*$/);
    return m ? m[1] : '';
  }
  function formatLine(roleName, value){
    const n = extractSuffixNumber(roleName);
    return roleName + ' : ' + value + (n ? ' | ت ' + n : '');
  }

  function readRowValue(row){
    if (!row) return null;
    const roleName = (row.querySelector('.label-col') ? row.querySelector('.label-col').textContent : '') || '';
    const codeInput = row.querySelector('.role');
    const chk = row.querySelector('.checkbox-inline input[type="checkbox"]');
    const playerMention = row.querySelector('.playerMention');
    let val = 'H-000';
    if (chk && chk.checked){
      const raw = (playerMention && playerMention.value) ? playerMention.value.trim() : '';
      val = raw ? (raw.startsWith('@')?raw:('@'+raw)) : '@';
    } else if (codeInput){
      val = (codeInput.value && codeInput.value.trim()) ? codeInput.value.trim() : 'H-000';
    }
    return { roleName, val };
  }

  function buildReportText(){
    const out = [];
    const shiftLabel = 'الميناء';
    const timeLabel = (document.getElementById('shiftTimeDisplay') && document.getElementById('shiftTimeDisplay').value) || '6 صباحا';

    out.push('***تقرير العمليات في التوسعات ***');
    out.push('');
    out.push('**تم استلام عمليات ' + shiftLabel + ' في تمام الساعه ' + timeLabel + ' **');
    out.push('');

    const rows = document.querySelectorAll('.form-grid .row-grid');
    rows.forEach(r=>{
      if (r.classList.contains('full-row')) return;
      const d = readRowValue(r);
      if (d && d.roleName && !/^\s*$/.test(d.roleName)) out.push(formatLine(d.roleName, d.val));
    });

    // trim
    while (out.length && out[out.length-1]==='') out.pop();
    return out.join('\n');
  }

  const buildBtn = document.getElementById('buildReport');
  const copyBtn = document.getElementById('copyReport');
  const output = document.getElementById('reportOutput');
  buildBtn.addEventListener('click', ()=>{
    output.value = buildReportText();
    copyBtn.style.display='inline-block';
    output.focus(); output.select();
  });
  copyBtn.addEventListener('click', async ()=>{
    try { await navigator.clipboard.writeText(output.value); copyBtn.textContent='تم النسخ ✓'; setTimeout(()=>copyBtn.textContent='نسخ التقرير',1500); } catch(e){ alert('فشل النسخ'); }
  });
</script>
</body>
</html>
